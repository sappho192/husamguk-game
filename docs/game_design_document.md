# 후삼국시대 로그라이트 전략 게임 기획서

## 1. 게임 개요

### 1.1 컨셉
**"30분 런의 후삼국시대 로그라이트 전략 게임"**

한반도 후삼국시대(후백제, 태봉/고려, 신라)를 배경으로 한 턴제 전략 게임에 로그라이트 요소를 결합하여, 짧은 플레이 세션에서도 전략적 깊이와 반복 플레이의 재미를 제공한다.

### 1.2 기본 정보

| 항목 | 내용 |
|------|------|
| 장르 | 턴제 전략 + 로그라이트 |
| 배경 | 한반도 후삼국시대 |
| 목표 플레이 시간 | 1런 약 30분 (10분 × 3스테이지) |
| 핵심 시스템 | 내정, 전투, 로그라이트 |
| 타겟 플랫폼 | PC (게임패드 지원) |
| 개발 엔진 | Godot Engine 4.5 |

### 1.3 벤치마크 작품

| 작품 | 참고 요소 |
|------|----------|
| 코나미 삼국지 시리즈 | 내정/전투의 기본 구조 |
| Into the Breach | 소규모 그리드 전투, 퍼즐적 깊이 |
| Slay the Spire | 덱빌딩, 강화 선택 시스템 |
| Hades | 메타 프로그레션, 스토리 전달 방식 |
| 트릭컬 리바이브 | ATB + 글로벌 턴 기반 전투 흐름 |
| Final Fantasy (ATB) | 유닛별 턴 주기 시스템 |

---

## 2. 게임 구조

### 2.1 런 구조

1런은 3개의 스테이지로 구성되며, 각 스테이지는 약 10분 내외로 플레이된다.

```
[1 런 = 약 30분]

┌─────────────────────────────────────────────────────────┐
│ 스테이지 1: 형성기 (10분)                                │
│ ┌──────────┐    ┌──────────┐    ┌───────────┐          │
│ │ 내정 3턴  │ → │ 소규모   │ → │ 운명적 조우│          │
│ │ (선택지)  │    │ 전투 1회 │    │ (NPC 만남)│          │
│ └──────────┘    └──────────┘    └───────────┘          │
│                                  ↓ 강화 선택 (3 중 1)   │
├─────────────────────────────────────────────────────────┤
│ 스테이지 2: 각축기 (10분)                                │
│ ┌──────────┐    ┌──────────┐    ┌───────────┐          │
│ │ 내정 3턴  │ → │ 전투     │ → │ 운명적 조우│          │
│ │ + 이벤트  │    │ 1~2회   │    │ (NPC 만남)│          │
│ └──────────┘    └──────────┘    └───────────┘          │
│                                  ↓ 강화 선택 (3 중 1)   │
├─────────────────────────────────────────────────────────┤
│ 스테이지 3: 결전기 (10분)                                │
│ ┌──────────┐    ┌──────────┐    ┌──────────┐           │
│ │ 내정 2턴  │ → │ 대규모   │ → │ 엔딩     │           │
│ │ (최종준비)│    │ 보스전   │    │ + 보상   │           │
│ └──────────┘    └──────────┘    └──────────┘           │
└─────────────────────────────────────────────────────────┘
                       ↓
              [메타 프로그레션 적용]
                       ↓
                  [다음 런]
```

### 2.2 스테이지별 특징

| 스테이지 | 이름 | 내정 | 전투 | 스토리 초점 |
|----------|------|------|------|-------------|
| 1 | 형성기 | 3턴 | 소규모 1회 | 국가 형성, 장수 능력 개발 |
| 2 | 각축기 | 3턴 + 이벤트 | 1~2회 | 국가 간 소규모 충돌 |
| 3 | 결전기 | 2턴 | 대규모 보스전 | 시대의 결말, 통일 전쟁 |

### 2.3 게임오버 조건

- 주인공 장수의 사망 (패퇴 판정 시에는 거점 도시로 복귀)
- 거점 도시 함락 + 재지정 불가능한 상태

### 2.4 런 실패 시

- 완전 처음부터 다시 시작
- 메타 프로그레션(영구 강화)은 유지됨

---

## 3. 내정 시스템

### 3.1 기본 구조

**선택지 기반 내정**으로, 매 턴 2~3개의 선택지 중 하나를 고르는 방식이다.

### 3.2 선택지 카테고리

| 카테고리 | 예시 | 효과 |
|----------|------|------|
| 군사 | 병력 충원, 훈련 강화 | 전투 관련 수치 증가 |
| 경제 | 세금 징수, 농업 개발 | 자원 획득, 다음 선택지 확장 |
| 외교 | 호족 회유, 첩보 활동 | 이벤트 확률 변경, 버프/디버프 |
| 인재 | 장수 훈련, 등용 시도 | 장수 능력 강화, 새 유닛 획득 |

### 3.3 이벤트 연동

- 고른 선택지의 방향에 상응하는 무작위 이벤트가 함께 발생
- 예: "군사" 선택 시 → "탈영병 발생" 또는 "의용병 합류" 이벤트 확률적 등장

### 3.4 내정에서의 핵심 재미

- 트레이드오프 결정: 당장의 전투력 vs 장기적 성장
- 이벤트와의 상호작용으로 인한 런마다 다른 전개

---

## 4. 전투 시스템

### 4.1 기본 구조

**타이밍 중심 + 자원 관리 보조** 설계를 채택한다.

| 요소 | 역할 | 깊이 |
|------|------|------|
| ATB 턴 주기 | 핵심 | 스킬 타이밍 결정 |
| 강화 카드 | 보조 | 글로벌 턴 자원 관리 |
| 포지셔닝 | 단순화 | 전투 전 진형 선택으로 압축 |

### 4.2 전투 규모

- 양측 3~5 유닛
- 소규모 그리드 (3×3 또는 전열/후열 2줄)
- 전투 중 이동은 최소화

### 4.3 ATB (Active Time Battle) 시스템

- 각 유닛은 병종과 스탯에 따라 개별 ATB 게이지를 가짐
- 게이지가 차면 해당 유닛이 행동 가능
- 플레이어는 "언제 스킬을 쓸 것인가"를 결정

### 4.4 글로벌 턴 시스템

트릭컬 리바이브의 시스템을 참고 (Phase 2에서 구현 완료):

- 별도의 글로벌 턴 주기 존재 (10초 간격)
- 글로벌 턴이 돌아오면 전투 일시정지
- 일시정지 상태에서 덱의 강화 카드 사용 가능 (하단 카드 핸드에서 선택)
- **장수 고유 스킬은 ATB와 무관하게 쿨다운만으로 관리** (Phase 2 설계 확정)
  - 화면 왼쪽 스킬 바에서 언제든 클릭하여 발동 가능
  - 스킬 사용 시 ATB 리셋하지 않음 (일반 공격과 독립적)
  - 쿨다운은 글로벌 턴마다 감소

### 4.5 전투 카드 시스템

- 런 내에서 획득한 강화가 카드 형태로 덱에 추가됨
- 글로벌 턴마다 카드 1장 사용 (또는 패스)
- 어떤 카드를 어떤 전투에 아껴둘지 = 런 전체의 자원 관리

### 4.6 전투의 핵심 재미

- 스킬 타이밍: 적의 큰 공격 전에 방어기 vs 선제 공격으로 끊기
- 카드 운용: 이번 전투에 쓸지 vs 다음 전투(보스전)를 위해 아낄지

---

## 5. 운명적 조우 (Fateful Encounter) 시스템

### 5.1 기본 개념

**Phase 3D에서 추가된 서사 중심 시스템**으로, 단순한 강화 선택을 전설적 인물과의 만남으로 변환한다.

### 5.2 NPC 시스템

각 스테이지 종료 후, 5명의 전설적 인물 중 1명과 무작위로 조우한다.

| NPC | 특성 | 제공 테마 | 캐릭터 |
|-----|------|----------|--------|
| 도선국사 (Doseon) | 풍수지리의 대가 | 치유, 방어, 지원 | 신라 말기 승려 |
| 이제마 (Yi Je-ma) | 사상의학 창시자 | 치유, 방어, 지원 | 조선 말기 한의사 |
| 원효 (Wonhyo) | 대중의 스승 | 신비, 버프, 속도 | 신라 중기 승려 |
| 의상 (Uisang) | 화엄종 조사 | 신비, 버프, 속도 | 화엄종 창시자 |
| 최치원 (Choi Chi-won) | 고운 선생 | 전술, 카드, 지휘 | 은자형 대학자 |

### 5.3 테마 기반 강화 제공

- 각 NPC는 자신의 전문 분야에 맞는 강화를 제공
- 14개의 강화는 10개의 테마 태그로 분류됨
- NPC의 테마와 일치하는 강화 풀에서 3개 선택 (커먼 1, 레어 1, 레전더리 1)

**예시:**
- 도선국사/이제마 (풍수/의학): 방어력 증가, 병력 회복, 피해 감소 강화
- 원효/의상 (불교 승려): 정신적 강화, 버프 효과, ATB 속도 강화
- 최치원 (학자): 카드 효과 증강, 전술적 이점, 지휘 강화

### 5.4 서사적 경험

- 각 NPC는 고유한 대화 (인사, 대화, 제안)를 가짐
- 명일방주 통합전략 모드 영감의 UI 디자인
- 플레이어는 캐릭터의 개성을 느끼며 강화를 선택

### 5.5 시스템 효과

- 단순한 숫자 선택이 아닌 스토리적 맥락 제공
- 각 NPC의 테마로 인해 런마다 다른 강화 경로
- 향후 확장 가능 (NPC 호감도, 특수 조건 조우 등)

---

## 6. 로그라이트 시스템

### 6.1 런 내 강화 (일시적)

#### 강화 획득 시점

| 시점 | 강화 유형 |
|------|----------|
| 내정 선택 보상 | 스탯 강화 |
| 전투 승리 보상 | 전투 카드 |
| 이벤트/보스전 보상 | 패시브 |

#### 강화 카테고리

| 카테고리 | 예시 |
|----------|------|
| 스탯 강화 | 공격력 +10%, 병력 회복 +20 |
| 전투 카드 | 새로운 계략 카드 획득 |
| 패시브 | "첫 턴 선제공격", "낮은 HP에서 치명타율 증가" |

#### 강화 선택

- 3개 선택지 중 1개 선택

#### 페널티 있는 강화 예시

```
[격노한 병사들]
효과: 공격력 +40%
페널티: 매 글로벌 턴마다 병력 -5% (사기 저하로 이탈)

[급조된 방벽]
효과: 첫 2턴 받는 피해 -50%
페널티: 이동 속도(ATB 충전) -30%

[이간계 성공]
효과: 적 유닛 하나가 아군으로 전향
페널티: 해당 유닛 HP 50%로 시작, 배신 확률 있음

[무리한 징병]
효과: 병력 +50%
페널티: 다음 내정 페이즈에서 민심 선택지 등장 불가
```

### 6.2 메타 프로그레션 (영구적)

- 이벤트/엔딩에서 얻은 보상으로 영구 강화 해금
- 대상: 내정 효율, 장수 기본 능력치, 병종 스탯 등

#### 밸런스 원칙

- Hades의 "어둠" 시스템 참고
- 너무 강하면 초반 런이 무의미해짐
- 너무 약하면 반복 플레이 동기 부족
- 점진적이면서 체감되는 강화 설계 필요

---

## 7. 국가 및 장수 시스템

### 7.1 플레이어블 조합

**초기 버전**: 국가 3개 × 대표 장수 3명 = 9개 조합

### 7.2 국가별 특성

국가가 전체적인 플레이 스타일을 결정한다.

| 국가 | 특성 | 시작 카드 풀 성향 |
|------|------|-------------------|
| 후백제 (견훤) | 공격적, 속전속결 | 공격 카드 多, 높은 ATB |
| 태봉/고려 (궁예→왕건) | 균형, 외교 | 버프/디버프 카드, 아군 시너지 |
| 신라 | 수비적, 후반 강함 | 방어/회복 카드, 낮은 초반 스탯 |

### 7.3 장수별 역할

같은 국가 내 3장수는 역할군으로 구분된다.

| 역할 | 고유 스킬 특성 | 플레이 스타일 |
|------|---------------|---------------|
| 돌격형 | 단일 대상 고데미지 | 핵심 적 빠른 제거 |
| 지휘형 | 아군 버프 / 적 디버프 | 팀 시너지 극대화 |
| 특수형 | 상황 역전 (부활, 턴 조작 등) | 위기 대응, 변칙 플레이 |

### 7.4 차별화 요소 (검토 필요)

각 조합의 차별화를 위해 다음 요소들을 검토:
- 시작 능력 차이
- 고유 이벤트
- 전용 스토리 라인

---

## 8. 역사적 요소

### 8.1 기본 방침

- 역사적 사건을 활용하되, IF 전개도 가능하게 함
- 고정 이벤트와 확률 이벤트를 조합

### 8.2 고정 이벤트 (스테이지 전환점)

각 스테이지 끝에 해당 국가의 역사적 전환점이 등장한다.

**후백제 루트 예시:**
| 스테이지 | 이벤트 |
|----------|--------|
| 1 끝 | 견훤의 후백제 건국 선포 |
| 2 끝 | 신라 경주 침공 (경애왕 시해 사건) |
| 3 | 신검의 반란 또는 왕건과의 최종전 |

### 8.3 확률 이벤트 (런마다 변화)

역사적 사건을 "만약에?"로 변주한다.

```
[이벤트: 호족의 귀부]
"인근 호족이 귀부를 제안합니다"

선택지 A: 받아들인다
  → 병력 +30%, 하지만 다음 전투에서 배신 가능성

선택지 B: 거절한다
  → 다음 내정에서 민심 +20%, 해당 호족이 적으로 등장

선택지 C: [왕건 전용] 혼인 동맹
  → 영구 패시브 "호족 연합" 획득
```

### 8.4 IF 엔딩

역사와 다른 결말도 가능:
- 후백제가 삼한을 통일
- 신라가 부흥에 성공
- 궁예가 축출당하지 않고 태봉 유지

### 8.5 역사 이벤트 활용 (검토 필요)

구체적인 역사 사건 목록과 게임 내 활용 방안은 추가 조사 필요:
- 왕건의 고려 건국
- 견훤의 후백제 건국
- 궁예의 태봉 건국 및 몰락
- 주요 전투 (고창 전투, 일리천 전투 등)

---

## 9. 개발 계획

### 9.1 프로토타입 우선순위

| 순서 | 목표 | 내용 | 상태 |
|------|------|------|------|
| 1 | 전투 코어 | ATB + 스킬 타이밍만 있는 3 vs 3 전투 | ✅ **완료** (Phase 1) |
| 2 | 전투 확장 | 글로벌 턴 + 카드 시스템 + 장수 스킬 | ✅ **완료** (Phase 2) |
| 3 | 내정 연결 | 선택지 3개 → 전투 → 강화 선택 | ✅ **완료** (Phase 3) |
| 3D | 운명적 조우 | NPC 조우 시스템 + 테마 기반 강화 제공 | ✅ **완료** (Phase 3D) |
| 4 | 메타 프로그레션 | 세이브/로드 + 영구 강화 + 적 스케일링 | 🔲 계획됨 (Phase 4) |

### 9.2 Phase 1 구현 완료 (2025-01)

**완료된 기능:**
- ✅ ATB 전투 시스템 (개별 유닛 게이지)
- ✅ 6종 기본 병종 (창병, 검병, 궁병, 경기병, 중기병, 석궁병)
- ✅ 9명 장수 데이터 (후백제 3, 태봉 3, 신라 3)
- ✅ 특성 시스템 (대기병, 광전사, 돌격, 중갑, 원거리, 관통)
- ✅ 자동 전투 AI (테스트용)
- ✅ 승리/패배 조건 판정
- ✅ 한국어/영어 현지화
- ✅ YAML 기반 데이터 아키텍처
- ✅ 플레이스홀더 그래픽 시스템

### 9.3 Phase 2 구현 완료 (2025-12)

**완료된 기능:**
- ✅ 장수 고유 스킬 시스템 (9개 스킬: 견훤, 왕건, 신검 등)
- ✅ 스킬 쿨다운 관리 (ATB 독립적)
- ✅ 글로벌 턴 타이머 (10초 간격)
- ✅ 카드 시스템 (13장: 스타터 덱 5종 + 고급 카드 8종)
- ✅ 버프/디버프 시스템 (지속시간 추적)
- ✅ 스킬 바 UI (화면 왼쪽, 유닛별 스킬 버튼)
- ✅ 카드 핸드 UI (화면 하단, 3-5장)
- ✅ 덱 관리 (카드 드로우, 버리기 더미, 셔플)
- ✅ 이중 타이밍 시스템 (개별 ATB + 글로벌 턴 일시정지)

**플레이 가능:**
- 3v3 전투 with 장수 스킬 + 전략 카드
- 화면 왼쪽 스킬 버튼 클릭으로 스킬 발동
- 글로벌 턴(10초) 도달 시 카드 사용 가능
- 전투 BGM 무한 루프 재생
- scenes/battle.tscn 실행 (F5 in Godot)

**설계 확정사항:**
- 스킬은 ATB와 무관 (쿨다운만 관리)
- 스킬 사용 시 ATB 리셋하지 않음
- 버프 지속시간은 글로벌 턴 기준 (ATB 턴 아님)

**UI 레이아웃:**
- 상단: 적군 유닛 표시
- 중앙 하단: 아군 유닛 표시
- 왼쪽: 스킬 바 (각 유닛별 스킬 버튼)
- 하단 위: 글로벌 턴 타이머
- 하단: 카드 핸드 (3-5장)

**기술 스택:**
- Godot 4.5
- GDScript
- godot-yaml addon (fimbul-works)
- 데이터 파일: 99개 현지화 문자열 (한/영)
- 오디오: OGG Vorbis 형식 (루프 재생)

### 9.4 Phase 3 구현 완료 (2025-12)

**완료된 기능:**
- ✅ GameManager 오토로드 (런 오케스트레이션, 씬 전환)
- ✅ RunState 클래스 (유닛 상태 지속: HP, 스탯, 버프, 장수 쿨다운)
- ✅ 내정 시스템 (20개 이벤트, 4개 카테고리)
- ✅ 강화 시스템 (14개 강화: 5 커먼, 5 레어, 4 레전더리)
- ✅ 메인 메뉴, 승리/패배 화면
- ✅ 완전한 3스테이지 런 루프
- ✅ 이벤트 플래그 시스템 (분기 선택지)
- ✅ 189개 현지화 문자열 (한국어 + 영어)

**플레이 가능:**
- 완전한 로그라이트 런: 메인 메뉴 → 3개 전투 스테이지 → 승리/패배
- 각 스테이지 사이: 내정 (3개 거버넌스 선택) → 강화 선택 (3개 중 1개)
- 유닛 HP, 스탯, 버프가 모든 전투에 유지됨
- 런 통계 추적 (클리어 스테이지, 승리 전투, 선택 결정, 획득 강화)

### 9.5 Phase 3D 구현 완료 (2025-12)

**완료된 기능:**
- ✅ NPC 시스템 (5명의 전설적 인물과 고유 대화)
- ✅ 테마 기반 강화 필터링 (치유, 신비, 전술 등)
- ✅ 서사 중심 조우 UI (명일방주 영감)
- ✅ NPC 초상화 디스플레이 컴포넌트 (테마 적용)
- ✅ 운명적 조우 씬 (단순 강화 선택 대체)
- ✅ 14개 강화에 테마 태그 확장
- ✅ 27개 추가 현지화 문자열 (한국어 + 영어 → 총 216개)
- ✅ DataManager NPC 로딩 및 테마 필터링 API

**NPC 목록:**
- 도선국사 (Doseon) - 풍수지리: 치유/방어/지원 강화 제공
- 이제마 (Yi Je-ma) - 사상의학: 치유/방어/지원 강화 제공
- 원효 (Wonhyo) - 불교 승려: 신비/버프/속도 강화 제공
- 의상 (Uisang) - 화엄종: 신비/버프/속도 강화 제공
- 최치원 (Choi Chi-won) - 학자: 전술/카드/지휘 강화 제공

**플레이 가능:**
- 완전한 로그라이트 런: 메인 메뉴 → 3개 전투 스테이지 → 승리/패배
- 각 스테이지 사이: 내정 (3개 거버넌스 선택) → 운명적 조우 (5명 NPC 중 1명)
- NPC가 캐릭터에 맞는 테마 강화 제공 (의사는 치유, 도사는 버프 등)
- 유닛 HP, 스탯, 버프가 모든 전투에 유지됨
- 런 통계 추적 (클리어 스테이지, 승리 전투, 선택 결정, 획득 강화)

### 9.6 Phase 3D 추가 개선 (2025-12-30)

**완료된 개선:**
- ✅ 전투 간 장수 스킬 쿨다운 초기화 (각 전투 시작 시 모든 스킬 사용 가능)
- ✅ 디버그/테스트 기능: 전투 화면에 강제 승리/패배 버튼 추가 (우측 상단)
- ✅ 운명적 조우 UI 조정 (타이틀 위치 상향)

**설계 확정:**
- 장수 스킬 쿨다운은 RunState에 저장하지 않음 (전투마다 리셋)
- 내정 단계를 거치므로 다음 전투에서는 항상 스킬이 준비된 상태로 시작
- 디버그 버튼은 방어력 계산을 우회하여 즉시 승패 처리

### 9.7 Phase 4 구현 완료 (2025-12)

**완료된 기능:**
- ✅ 웨이브 기반 전투 시스템 (스테이지당 3-4 웨이브)
- ✅ 전투 데이터 스키마 및 YAML 정의 (data/battles/)
- ✅ 웨이브 보상 (HP 회복, 글로벌 턴 리셋, 버프 지속시간 연장)
- ✅ 웨이브 UI (카운터, 전환 메시지)
- ✅ ATB 속도 최적화 (4배 가속: 행동당 ~2.5초로 단축)
- ✅ 웨이브별 동적 적 생성
- ✅ 장수 쿨다운 스테이지 간 리셋 (새 인스턴스 생성)

**웨이브 구조:**
- **스테이지 1**: 3 웨이브 (2, 3, 4 적) - 튜토리얼 난이도
- **스테이지 2**: 3 웨이브 (3, 3, 4 적) - 중간 난이도
- **스테이지 3**: 3 웨이브 (3, 4, 5 적) - 최종 보스 (장수 2명 포함)

**웨이브 보상 시스템:**
- 각 웨이브 클리어 후 (첫 웨이브 제외):
  - HP 회복 (최대 HP의 10-20%)
  - 글로벌 턴 리셋 (즉시 카드 드로우)
  - 버프 지속시간 연장 (1-3턴)

**플레이 가능:**
- 완전한 로그라이트 런: 메인 메뉴 → 3개 전투 스테이지 (각 3 웨이브) → 승리/패배
- 웨이브 전환 시 2초 일시정지 및 "웨이브 X 완료!" 메시지
- 웨이브 진행 상황 UI (화면 상단 중앙)

### 9.8 Phase 5 구현 완료 (2025-12)

**Phase 5A: 16×16 타일 기반 지형 그리드 (완료)**
- ✅ 6개 지형 타입 및 수정자 (평지, 산, 숲, 강, 도로, 벽)
- ✅ TerrainTile 및 BattleMap 클래스
- ✅ 3개 스테이지 맵 (스폰 존 포함)
- ✅ TileDisplay (40×40px) 및 TileGridUI (640×640px) 컴포넌트
- ✅ DataManager 지형/맵 로딩

**지형 효과:**
- 평지 (Plain): 중립 (수정자 없음)
- 산 (Mountain): 방어 +30%, 공격 -10%, 이동 비용 2.5배
- 숲 (Forest): 방어 +20%, ATB -5%, 이동 비용 1.5배
- 강 (River): 방어 -20%, 공격 -10%, 이동 비용 3배
- 도로 (Road): 방어 -10%, ATB +5%, 이동 비용 0.5배
- 벽 (Wall): 통행 불가

**Phase 5B: 부대 시스템 (완료)**
- ✅ Corps 클래스 (장수 + 병사, 그리드 위치)
- ✅ 6개 부대 템플릿 (창병, 검병, 경/중기병, 궁병, 석궁병)
- ✅ Formation 클래스 (5개 진형: 학익진, 봉시진, 방원진, 장사진, 어린진)
- ✅ 유닛 타입별 공격 범위 (보병: 1, 기병: 2, 궁병: 4-5)
- ✅ CorpsDisplay 컴포넌트 (HP/ATB 바, 병사 수)

**부대 시스템 특징:**
- 부대 = 장수 + 병사: 한 타일당 하나의 부대
- 부대 템플릿은 병사 타입, 수, 스탯, 진형 정의
- 장수의 통솔력은 +1 병사/10 통솔력 보너스 제공
- 공격 범위는 유닛 타입에 따라 다름 (근접/돌격/원거리)

**진형 효과 (스탯 수정자만, 공간 배치 아님):**
- 학익진 (Crane Wing): 공격 +30%, 방어 -10%, ATB +0.1
- 봉시진 (Arrow Point): 공격 +50%, 방어 -30%, ATB +0.2, 이동 +1
- 방원진 (Circular): 공격 -20%, 방어 +50%, ATB -0.2, 이동 -1
- 장사진 (Serpent): 방어 -15%, ATB +0.15, 이동 +2
- 어린진 (Fish Scale): 공격 +15%, 방어 +15%

**Phase 5C: 명령 시스템으로 강화된 ATB (완료)**
- ✅ CorpsCommand 클래스 (5개 명령 타입)
- ✅ CommandPanel UI (ATTACK, DEFEND, EVADE, WATCH, MOVE)
- ✅ MovementOverlay (범위 강조, 목적지 선택)
- ✅ 글로벌 턴 중 이동 단계 실행
- ✅ BattleManager 명령 큐 및 실행
- ✅ 공격 범위 검증
- ✅ CorpsBattleUI 통합 (테스트 씬)
- ✅ 67개 추가 로컬라이제이션 문자열 (한국어 + 영어 → 총 283개)

**5가지 명령 타입 (ATB 충전 시 선택):**
- **공격 (ATTACK)**: 범위 내 적 부대 타겟
- **방어 (DEFEND)**: 1턴 동안 방어력 +50%
- **회피 (EVADE)**: 1턴 동안 ATB 속도 +0.3
- **감시 (WATCH)**: 반격 준비 상태 (부분 구현, 추후 확장 예정)
- **이동 (MOVE)**: 다음 글로벌 턴을 위한 이동 큐

**이동 단계:**
- MOVE 명령은 글로벌 턴(카드 선택 후) 중 실행
- BFS 경로 찾기로 자동 경로 계산
- 지형 이동 비용 고려

**플레이 가능:**
- `scenes/corps_battle_test.tscn` - 16×16 그리드에서 부대 기반 전술 전투
- 공격 범위 유효성 검증을 통한 완전한 명령 시스템
- 지형 효과 및 진형 수정자
- 글로벌 턴 중 이동 단계

### 9.6.1 개발 도구: Battle Simulator (2025-12-30)

**완료된 기능:**
- ✅ Headless 모드 전투 시뮬레이션 (GUI 없이 자동 실행)
- ✅ YAML 기반 시나리오 설정 (`simulation_config.yaml`)
- ✅ 다양한 유닛/장수 조합 테스트 지원
- ✅ 배치 시뮬레이션 (N회 반복 실행)
- ✅ 10배 가속 시뮬레이션 (Engine.time_scale)
- ✅ CSV 형식 raw 데이터 출력 (각 전투의 상세 정보)
- ✅ JSON 형식 요약 통계 출력 (승률, 평균 시간, 데미지 통계)

**사용 사례:**
- 유닛/장수 밸런스 테스트
- 대규모 통계 수집 (100회+ 반복)
- 새로운 장수/유닛 추가 전 밸런스 검증
- ATB 속도, 공격력, 방어력 등 수치 조정 효과 분석

**출력 통계:**
- 기본: 승률, 평균 전투 시간, 평균 글로벌 턴
- 데미지: 팀별 평균/총 데미지 (가한/받은)
- 향후 확장 가능: ATB 속도 분석, 스킬 사용 빈도, 유닛별 기여도 등

**파일 위치:**
- `src/tools/battle_simulator.gd` - 시뮬레이터 메인 로직
- `scenes/battle_simulator.tscn` - 시뮬레이터 씬
- `simulation_config.yaml` - 시나리오 설정 파일
- `docs/BATTLE_SIMULATOR.md` - 사용 가이드

### 9.9 Phase 6 구현 완료 (2025-12-31)

**완료된 기능:**
- ✅ 전투 스키마 확장 (유닛과 부대 모두 지원, template_id 필드)
- ✅ 3개 부대 기반 웨이브 전투 정의 (stage_1/2/3_corps_battle)
- ✅ BattleManager 부대 웨이브 생성 및 보상 기능 확장
- ✅ CorpsBattleUI 웨이브 UI 통합 (카운터, 전환 메시지)
- ✅ 웨이브 간 아군 부대 위치 리셋
- ✅ 직접 공격 명령 (아군 클릭 → 적군 클릭 단축키)
- ✅ GameManager 부대 전투를 메인 전투 모드로 설정
- ✅ 런 시스템과 완전 통합 (내정 → 운명적 조우 → 부대 전투)

**플레이 가능:**
- 완전한 로그라이트 런: 메인 메뉴 → 3개 전투 스테이지 (부대 기반 웨이브) → 승리/패배
- 각 스테이지: 16×16 그리드에서 3 웨이브 전투
  - 스테이지 1: 3 웨이브 (2, 3, 4 부대)
  - 스테이지 2: 3 웨이브 (3, 3, 4 부대)
  - 스테이지 3: 3 웨이브 (3, 4, 5 부대) - 장수 2명 포함
- 웨이브 보상: HP 회복, 글로벌 턴 리셋, 버프 연장
- 웨이브 간 아군 부대 초기 위치로 복귀
- 메인 씬: `scenes/corps_battle_test.tscn`

### 9.10 Phase 7 목표 (메타 프로그레션)

**계획된 기능:**
- 🔲 SaveManager 완전 구현 (세이브/로드 기능)
- 🔲 메타 프로그레션 잠금 해제 (영구 업그레이드)
- 🔲 플레이어 진행 추적
- 🔲 콘텐츠 확장 (더 많은 전투, 이벤트, 강화)
- 🔲 MOD 시스템 완전 구현
- 🔲 밸런스 조정 및 폴리시

---

## 10. 미정 사항

추가 검토 및 결정이 필요한 항목:

| 항목 | 내용 |
|------|------|
| 강화 구체적 형태 | 스탯/스킬/패시브 비율 및 수치 밸런스 |
| 페널티 있는 강화 | 구체적인 목록 및 밸런스 |
| 국가/장수 차별화 | 시작 능력, 고유 이벤트, 스토리의 구체적 설계 |
| 역사 이벤트 목록 | 고정/확률 이벤트의 전체 목록 |
| 메타 프로그레션 상세 | 영구 강화 항목 및 해금 조건 |

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2025-12-29 | 초안 작성 |
| 2025-12-29 | Phase 1 (전투 코어) 구현 완료, 개발 계획 섹션 업데이트 |
| 2025-12-29 | Phase 2 (전투 확장) 구현 완료, 스킬 시스템 설계 확정 |
| 2025-12-29 | Phase 2 UI 수정 완료 (스킬 ATB 독립화, 타이머/유닛 배치 수정, BGM 추가) |
| 2025-12-30 | Phase 3 (내정 연결) 구현 완료, 완전한 3스테이지 런 루프 |
| 2025-12-30 | Phase 3D (운명적 조우) 구현 완료, NPC 시스템 및 테마 기반 강화 |
| 2025-12-30 | Phase 3D 개선: 쿨다운 리셋 로직, 디버그 버튼, UI 조정 |
| 2025-12-30 | 개발 도구: Battle Simulator 구현 (headless 밸런스 테스트 도구) |
| 2025-12-30 | NPC 이름 변경: 중국 삼국지 인물 → 한국 역사 인물 (도선국사, 이제마, 원효, 의상, 최치원) |
| 2025-12-31 | Phase 4 (웨이브 시스템) 구현 완료, 전투 데이터 스키마 및 웨이브 보상 |
| 2025-12-31 | Phase 5A (지형 그리드) 구현 완료, 16×16 타일 시스템 및 6개 지형 타입 |
| 2025-12-31 | Phase 5B (부대 시스템) 구현 완료, 부대 템플릿 및 진형 시스템 |
| 2025-12-31 | Phase 5C (명령 시스템) 구현 완료, 5가지 명령 타입 및 이동 단계 |
| 2025-12-31 | Phase 6 (웨이브 시스템 통합) 구현 완료, 부대 기반 전투를 메인 모드로 설정 |
| 2025-12-31 | 문서 업데이트: Phase 6 완료 상태 반영 (283 로컬라이제이션 문자열) |
